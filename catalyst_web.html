<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Catalyst - Article Map</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Leaflet CSS from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <!-- Animate.css for entrance animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #007bff;
            --glow-color: rgba(0, 123, 255, 0.5);
            --card-bg: rgba(255, 255, 255, 0.9);
            --border-color: #dee2e6;
            --transition: 0.3s ease;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; /* Prevent scrollbars from the page itself */
        }

        /* --- Map Container --- */
        #map {
            position: absolute;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            z-index: 1;
        }

        /* --- UI Components --- */
        #ui-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1000; /* Ensure UI is above the map */
        }
        #ui-container > * {
            pointer-events: auto;
        }

        /* Navbar */
        nav {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border-color);
        }
        nav .logo {
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--accent-color);
        }
        nav .logo i { margin-right: 8px; }

        /* Sidebar */
        #sidebar {
            position: absolute;
            top: 61px; /* Navbar height + border */
            left: 0;
            width: 280px;
            height: calc(100% - 61px);
            background: rgba(248, 249, 250, 0.85);
            backdrop-filter: blur(8px);
            padding: 20px;
            overflow-y: auto;
            transition: transform var(--transition);
            border-right: 1px solid var(--border-color);
        }
        #sidebar.collapsed { transform: translateX(-100%); }

        #sidebar h2 {
            font-family: 'Roboto Mono', monospace;
            color: var(--accent-color);
            margin-bottom: 16px;
            font-size: 1.1rem;
        }
        #sidebar .filter-group { margin-bottom: 24px; }
        #sidebar label {
            display: block;
            margin-bottom: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        #sidebar label:hover { color: var(--accent-color); }
        #sidebar input { margin-right: 8px; accent-color: var(--accent-color); }
        
        #toggle-sidebar {
            position: absolute;
            top: 75px;
            left: 280px;
            width: 28px;
            height: 40px;
            background: var(--accent-color);
            border: none;
            border-radius: 0 8px 8px 0;
            color: #fff;
            cursor: pointer;
            z-index: 95;
            transition: transform var(--transition), left var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #sidebar.collapsed + #toggle-sidebar { left: 0; }
        #toggle-sidebar .fa-chevron-left { transition: transform 0.3s; }
        #sidebar.collapsed + #toggle-sidebar .fa-chevron-left { transform: rotate(180deg); }

        /* Leaflet Popup Customization */
        .custom-popup .leaflet-popup-content-wrapper {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 0;
        }
        .custom-popup .leaflet-popup-content {
            margin: 0;
            width: 300px !important; /* Set a fixed width */
        }
        .custom-popup-image-container {
            width: 100%; height: 150px; overflow: hidden;
            border-radius: 11px 11px 0 0;
        }
        .custom-popup-image {
            width: 100%; height: 100%; object-fit: cover;
            border-bottom: 1px solid var(--border-color);
        }
        .custom-popup-content-area { padding: 20px; }
        .custom-popup-content-area h3 { font-size: 18px; color: var(--accent-color); margin-bottom: 5px; }
        .custom-popup-content-area p.author { font-size: 12px; font-style: italic; color: #6c757d; margin-bottom: 12px; }
        .custom-popup-content-area a.read-more {
            display: inline-block; padding: 8px 14px;
            background: var(--accent-color); color: #fff;
            border-radius: 8px; text-decoration: none;
            font-weight: 600; font-size: 14px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .custom-popup-content-area a.read-more:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--glow-color); }
        .custom-popup .leaflet-popup-close-button {
            top: 5px; right: 5px;
            width: 28px; height: 28px;
            background: rgba(0,0,0,0.1);
            border-radius: 50%; color: var(--text-color);
            font-size: 18px; line-height: 28px; text-align: center;
        }
        .custom-popup .leaflet-popup-close-button:hover { background: rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div id="map"></div>

    <div id="ui-container">
        <nav class="animate__animated animate__fadeInDown">
            <div class="logo"><i class="fas fa-atom"></i> The Catalyst Web</div>
        </nav>

        <aside id="sidebar" class="animate__animated animate__fadeInLeft">
            <div class="filter-group">
                <h2>// CATEGORIES</h2>
                <div id="category-filters"></div>
            </div>
        </aside>
        <button id="toggle-sidebar" class="animate__animated animate__fadeInLeft" title="Toggle Filters">
            <i class="fas fa-chevron-left"></i>
        </button>
    </div>

    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Article Data with Geographic Coordinates ---
        // I've added lat/lng to each article. You can adjust these as needed.
        const articleData = [
            { "id": "art0", "title": "The Road From Academia to Forensic Applications of Chemistry", "author": "Naama Ben-Dor", "summary": "While many scientific pursuits involve structured pre-professional programs...", "link": "https://www.catalyst-magazine.com/post/the-road-from-academia-to-forensic-applications-of-chemistry", "category": "Science & Policy", "image": "https://static.wixstatic.com/media/11b1c4_9737d25c5ad74ba7829973eb7513f61a~mv2.jpeg/v1/fill/w_780,h_452,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/shutterstock_1898354080.jpeg", "lat": 38.905, "lng": -77.039 },
            { "id": "art1", "title": "How One Engineer is Changing Sustainable Fuels", "author": "Aidan Schurr", "summary": "Tyler Wyka bridges engineering, sustainability, and global collaboration...", "link": "https://www.catalyst-magazine.com/post/how-one-engineer-is-changing-sustainable-fuels", "category": "Tech & Engineering", "image": "https://static.wixstatic.com/media/11b1c4_4491d15e55c94d058d2a63eedf3cfc42~mv2.png/v1/fill/w_780,h_452,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/shutterstock_1898354080.png", "lat": 38.911, "lng": -77.045 },
            { "id": "art2", "title": "From Music to Nuclear Policy: Dr. Cahill’s Journey in Science and Policy", "author": "Lori Preci and Yair Ben-Dor", "summary": "From music to materials science, Professor Christopher Cahill’s journey shows how unexpected turns spark curiosity...", "link": "https://www.catalyst-magazine.com/post/from-music-to-nuclear-policy-professor-christopher-cahill-s-unexpected-journey-in-science-and-polic", "category": "Science & Policy", "image": "https://static.wixstatic.com/media/11b1c4_0c15687348b442c5ab1d0a2295571751~mv2.jpeg/v1/fill/w_780,h_452,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/shutterstock_1898354080.jpeg", "lat": 38.895, "lng": -77.031 },
            { "id": "art3", "title": "Dr. Song Gao’s Chemistry‑Policy Crusade Against Hidden Pollutants", "author": "Naama Ben-Dor", "summary": "Dr. Song Gao bridges science and policy to tackle climate change, ozone depletion, and environmental sustainability.", "link": "https://www.catalyst-magazine.com/post/pollution-to-solution-dr-song-gao-on-science-policy-and-environmental-sustainability", "category": "Environmental Science", "image": "https://static.wixstatic.com/media/11b1c4_0384c4b9d49545a3b2e708073485f11b~mv2.jpg/v1/fill/w_780,h_452,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/shutterstock_1898354080.jpg", "lat": 38.920, "lng": -77.050 },
            { "id": "art5", "title": "Dr. Brent Harris’ Brain Bank Revolution", "author": "Aidan Schurr", "summary": "Working in DC lets Dr. Brent Harris drive medical changes. His neuropathology, ALS research, and advocacy...", "link": "https://www.catalyst-magazine.com/post/from-brain-to-bench-to-bedside-and-beyond-how-a-dc-neuroscientist-is-changing-brain-disease-researc", "category": "Health & Medicine", "image": "https://static.wixstatic.com/media/11b1c4_0790d57e5eef4d119d3c9497017df5ca~mv2.jpeg/v1/fill/w_780,h_452,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/shutterstock_1898354080.jpeg", "lat": 38.9076, "lng": -77.0722 },
            { "id": "art7", "title": "Serendipity and Science: The Journey of Dr. John Hawdon", "author": "Lori Preci", "summary": "Dr. Hawdon’s Winding Path to Parasitology...", "link": "https://www.catalyst-magazine.com/post/serendipity-and-science-the-journey-of-dr-john-hawdon", "category": "Health & Medicine", "image": "https://static.wixstatic.com/media/44031f_75620e6213e04a56b298580689208fce~mv2.jpeg/v1/fill/w_709,h_411,al_c,q_80,enc_avif,quality_auto/shutterstock_1898354080.jpeg", "lat": 38.8997, "lng": -77.0486 },
            { "id": "art8", "title": "Elucidating the Brain’s Language Circuitry with Dr. Michael Ullman", "author": "Yair Ben-Dor", "summary": "Georgetown neuroscientist Dr. Michael T. Ullman's Declarative/Procedural (DP) model posits language relies on two core brain memory systems.", "link": "https://www.catalyst-magazine.com/post/elucidating-the-brain-s-language-circuitry-with-dr-michael-ullman", "category": "Neuroscience & Cognition", "image": "https://static.wixstatic.com/media/11b1c4_4d74a6206a0f43c9a38125c8bc03e28e~mv2.jpg/v1/fill/w_780,h_452,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/shutterstock_1898354080.jpg", "lat": 38.915, "lng": -77.065 }
        ];

        // --- Map Initialization ---
        const map = L.map('map', {
            center: [38.9072, -77.0369], // Washington D.C.
            zoom: 14,
            zoomControl: true 
        });
        map.zoomControl.setPosition('bottomright');

        // --- Tile Layer ---
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);
        
        // --- Store Markers ---
        let markers = {};

        // --- Create Markers and Popups ---
        const categories = [...new Set(articleData.map(a => a.category))].sort();
        const colorScale = d3.scaleOrdinal()
            .domain(categories)
            .range(['#8A2BE2', '#00BFFF', '#228B22', '#FF4500', '#FFD700', '#D2691E', '#FF69B4']);

        articleData.forEach(article => {
            const marker = L.marker([article.lat, article.lng]).addTo(map);

            const popupContent = `
                <div class="custom-popup-image-container">
                    <img src="${article.image}" alt="${article.title}" class="custom-popup-image" onerror="this.src='https://placehold.co/300x150/0a0c10/c9d1d9?text=Image+Not+Found';">
                </div>
                <div class="custom-popup-content-area">
                    <h3>${article.title}</h3>
                    <p class="author">By ${article.author}</p>
                    <a href="${article.link}" target="_blank" rel="noopener noreferrer" class="read-more">Read Full Article</a>
                </div>
            `;

            marker.bindPopup(popupContent, {
                className: 'custom-popup',
                minWidth: 300
            });
            
            // Store marker for filtering
            markers[article.id] = marker;
        });

        // --- UI & Filtering ---
        const sidebar = document.getElementById('sidebar');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar');

        function initializeUI() {
            const filterContainer = document.getElementById('category-filters');
            filterContainer.innerHTML = ''; // Clear previous
            
            const allLabel = document.createElement('label');
            allLabel.innerHTML = `<input type="checkbox" id="filter-all" checked> Show All`;
            filterContainer.appendChild(allLabel);

            categories.forEach(category => {
                const label = document.createElement('label');
                label.innerHTML = `<input type="checkbox" class="category-filter" value="${category}" checked> ${category}`;
                filterContainer.appendChild(label);
            });
            
            document.getElementById('filter-all').addEventListener('change', (e) => {
                document.querySelectorAll('.category-filter').forEach(cb => cb.checked = e.target.checked);
                updateMarkerVisibility();
            });

            document.querySelectorAll('.category-filter').forEach(cb => {
                cb.addEventListener('change', updateMarkerVisibility);
            });
            
            toggleSidebarBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });
        }
        
        function updateMarkerVisibility() {
            const activeCategories = new Set(
                [...document.querySelectorAll('.category-filter:checked')].map(cb => cb.value)
            );
            
            articleData.forEach(article => {
                const marker = markers[article.id];
                if (marker) {
                    if (activeCategories.has(article.category)) {
                        marker.setOpacity(1);
                        marker.setZIndexOffset(100); // Bring to front
                    } else {
                        marker.setOpacity(0.2);
                        marker.setZIndexOffset(0); // Send to back
                    }
                }
            });
        }

        // --- Initialize ---
        initializeUI();
    });
    </script>
</body>
</html>
